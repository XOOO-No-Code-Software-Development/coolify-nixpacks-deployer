providers = ["python"]

[phases.setup]
nixPkgs = ["curl", "jq", "python311", "python311Packages.pip", "wget"]

[phases.install]
cmds = [
  "bash download-source.sh",
  "python -m venv /opt/venv",
  ". /opt/venv/bin/activate && pip install uvicorn",
  ". /opt/venv/bin/activate && if [ -f requirements.txt ]; then pip install -r requirements.txt; fi",
  ". /opt/venv/bin/activate && python -c 'import main; app = main.app; print(\"âœ… Application validation successful\")'",
  "# Install PostgREST",
  "wget -O /tmp/postgrest.tar.xz https://github.com/PostgREST/postgrest/releases/download/v12.2.3/postgrest-v12.2.3-linux-static-x64.tar.xz",
  "tar -xJf /tmp/postgrest.tar.xz -C /tmp",
  "mv /tmp/postgrest /usr/local/bin/postgrest",
  "chmod +x /usr/local/bin/postgrest",
  "rm /tmp/postgrest.tar.xz",
  "# Install pgAdmin in virtual environment",
  ". /opt/venv/bin/activate && pip install --no-cache-dir pgadmin4==8.12"
]